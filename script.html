<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FIT TRACKER PRO | Macros y Rendimiento (Premium)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Oswald:wght@500;700&display=swap');

        body {
            font-family: 'Inter', sans-serif;
            background-color: #0a0a0a;
            color: #f3f4f6;
        }
        h1, h2 {
            font-family: 'Oswald', sans-serif;
        }

        .card {
            background-color: #171717;
            border: 1px solid #374151;
        }

        .scroll-container {
            max-height: 350px;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: #06b6d4 #171717;
        }

        .scroll-container::-webkit-scrollbar { width: 8px; }
        .scroll-container::-webkit-scrollbar-track { background: #171717; }
        .scroll-container::-webkit-scrollbar-thumb {
            background-color: #06b6d4;
            border-radius: 20px;
            border: 2px solid #171717;
        }

        input:not([type="checkbox"]), select {
            background-color: #262626 !important;
            border-color: #525252 !important;
            color: #f3f4f6 !important;
        }
        input:focus, select:focus {
            border-color: #06b6d4 !important;
            box-shadow: 0 0 0 2px rgba(6, 182, 212, 0.5) !important;
        }

        .scroll-container table thead {
            position: sticky;
            top: 0;
            z-index: 10;
        }
        .categoria-header {
            position: sticky;
            top: 40px;
            z-index: 5;
        }
    </style>
</head>

<body class="p-4 sm:p-8">
<script>
tailwind.config = {
  theme: {
    extend: {
      colors: {
        'primary-dark': '#0a0a0a',
        'card-dark': '#171717',
        'accent-neon': '#06b6d4'
      }
    }
  }
};
</script>

<div class="max-w-4xl mx-auto space-y-6">
    <header class="flex justify-between items-center p-4 card rounded-xl shadow-lg border border-gray-700">
        <h1 class="text-3xl font-extrabold tracking-tight text-accent-neon uppercase">FIT TRACKER PRO</h1>
        <div id="auth-buttons"></div>
    </header>

    <div id="alert-container" class="space-y-4"></div>

    <!-- (Contenido de secciones omitido por brevedad: calculadora, resumen, registro comidas, etc.) -->
    <!-- âœ… Se mantiene igual que tu versiÃ³n anterior -->
</div>

<!-- ==================== MODALES ==================== -->
<div id="auth-modal" class="fixed inset-0 bg-primary-dark bg-opacity-90 z-50 transition-opacity duration-300 opacity-0 pointer-events-none flex items-center justify-center p-4">
  <div class="card w-full max-w-md p-6 rounded-xl shadow-2xl transform scale-95 transition-all duration-300 ease-in-out">
      <div class="flex justify-between items-center mb-4">
          <h3 id="auth-title" class="text-2xl font-bold text-accent-neon">Iniciar SesiÃ³n</h3>
          <button onclick="toggleAuthModal(false)" class="text-gray-400 hover:text-white transition-colors p-1 rounded-full hover:bg-gray-700">
              âœ•
          </button>
      </div>

      <div id="auth-message" class="hidden p-3 mb-4 text-sm rounded-lg bg-red-900 text-red-300"></div>

      <form onsubmit="event.preventDefault(); handleAuthSubmit();" class="space-y-4">
          <div>
              <label for="auth-email" class="block text-sm font-medium text-gray-400">Usuario</label>
              <input type="text" id="auth-email" class="mt-1 block w-full rounded-lg shadow-sm p-3" placeholder="Tu Nickname" required>
          </div>
          <div>
              <label for="auth-password" class="block text-sm font-medium text-gray-400">ContraseÃ±a</label>
              <input type="password" id="auth-password" class="mt-1 block w-full rounded-lg shadow-sm p-3" placeholder="MÃ­nimo 8 caracteres" required>
          </div>
          <button type="submit" id="auth-submit-btn" class="w-full px-4 py-3 text-base font-bold rounded-xl shadow-lg text-primary-dark bg-green-400 hover:bg-green-300 transition duration-150 uppercase">
              Acceder
          </button>
      </form>

      <p class="mt-4 text-sm text-center text-gray-400" id="auth-toggle-text">
          Â¿No tienes cuenta? <a href="#" onclick="showRegister()" class="text-accent-neon hover:underline font-semibold">ContÃ¡ctanos</a>
      </p>
  </div>
</div>

<div id="custom-modal" class="fixed inset-0 bg-primary-dark bg-opacity-90 z-40 transition-opacity duration-300 opacity-0 pointer-events-none flex items-center justify-center p-4">
  <div id="custom-modal-content" class="card w-full max-w-md p-6 rounded-xl shadow-2xl transform scale-95 transition-all duration-300 ease-in-out"></div>
</div>

<script>
/* ============================
   AUTENTICACIÃ“N SOLO LECTURA
===============================*/
const GITHUB_USERS_JSON_URL = "https://raw.githubusercontent.com/SantiagoObregon/Fit-Tracker-Pro/main/users.json";
let userState = { isLoggedIn: false, username: "", isPremium: false, customMacros: { p:40, g:30, c:30 } };
let usersDB = {};
let authMode = "login";

async function loadUserState() {
  try {
    const res = await fetch(GITHUB_USERS_JSON_URL, { cache: "no-store" });
    if (res.ok) {
      const jsonUsers = await res.json();
      Object.values(jsonUsers).forEach(u => {
        if (u.username) {
          const uname = u.username.toLowerCase();
          usersDB[uname] = {
            username: uname,
            password: u.password,
            isPremium: u.isPremium,
            customMacros: u.customMacros
          };
        }
      });
      console.log("Usuarios cargados:", usersDB);
    }
  } catch(e){ console.error("Error al cargar users.json:", e); }

  const stored = localStorage.getItem("userState");
  if (stored) userState = JSON.parse(stored);
  updateUIBasedOnState();
}

function saveUserState() {
  localStorage.setItem("userState", JSON.stringify(userState));
}

function handleAuthSubmit() {
  const username = document.getElementById("auth-email").value.toLowerCase().trim();
  const password = document.getElementById("auth-password").value;
  const msg = document.getElementById("auth-message");
  msg.classList.add("hidden");

  if (!username || password.length < 8) {
    msg.textContent = "Ingresa usuario vÃ¡lido y contraseÃ±a (mÃ­nimo 8 caracteres).";
    msg.classList.remove("hidden");
    return;
  }

  const user = usersDB[username];
  if (!user) {
    msg.textContent = "Usuario no encontrado. ContÃ¡ctanos para obtener acceso.";
    msg.classList.remove("hidden");
    return;
  }

  if (user.password !== password) {
    msg.textContent = "ContraseÃ±a incorrecta.";
    msg.classList.remove("hidden");
    return;
  }

  userState = { isLoggedIn: true, username, isPremium: user.isPremium, customMacros: user.customMacros };
  saveUserState();
  toggleAuthModal(false);
  alertModal(`Bienvenido ${username}`, "success");
  updateUIBasedOnState();
}

function showRegister() {
  alertModal(
    'El registro estÃ¡ deshabilitado.<br><br>ðŸ“§ <b>141038@encino.edu.mx</b><br>ðŸ“ž <b>+52 449 911 2222</b>',
    'info'
  );
}

function logout() {
  userState = { isLoggedIn:false, username:"", isPremium:false, customMacros:{p:40,g:30,c:30}};
  saveUserState();
  alertModal("SesiÃ³n cerrada.", "info");
  updateUIBasedOnState();
}

/* ========== Interfaz de usuario (resto de funciones se mantienen) ========== */
function toggleAuthModal(show){/* ... igual que tu versiÃ³n anterior ... */}
function alertModal(message,type='info'){/* ... igual que antes ... */}
function updateUIBasedOnState(){/* ... igual que antes ... */}
window.onload = ()=>{loadUserState();};
</script>
</body>
</html>
